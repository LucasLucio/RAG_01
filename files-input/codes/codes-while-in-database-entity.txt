ntry plAtualizaReserva
	params
		$t_ds_erro$ : Out
	endparams
	variables
		date v_dt_processo
		string v_nr_cpfmot
		struct v_stc_input, v_stc_output
	endvariables

	;Busca reservas pendentes para a D+0 e D+1
	v_dt_processo = "%%$date"

	;Cria nova instancia para chamada de opera√ß√£o
	newinstance "CFREO047", "CFREO047_PROCOFERTA", "Transaction=TRUE"

	;Busca as reservas que s√£o para atualizar
	clear/e "ctra_resordcarr"
	dt_embarque.ctra_resordcarr = v_dt_processo
	st_reserva.ctra_resordcarr  = "12" ; Reservado
	tp_segcarga.ctra_resordcarr = "2" 
	retrieve/e "ctra_resordcarr"

	;Valida erros de consulta
	if ($status < 0 & $status != -2)
		$t_ds_erro$ = "Falha ao ler dados da entidade CTRA_RESORDCARR com status %%$status"
		goto Erro
	endif

	;Valida se encontrou registros
	if ($status = -2)
		clear/e "ctra_resordcarr"	
	endif

	;Define valores para os dados de operador
	$t_tp_operador$   = 1
	$t_cd_operador$   = 1

	;Ordena em ordem crescente pela data de cria√ß√£o so registros
	sort "ctra_resordcarr", "dt_trscria.ctra_resordcarr:a"

	;Posiciona no primeiro registro encontrato
	setocc "ctra_resordcarr", 1

	;Realiza repeti√ß√£o enquando n√£o tiver um erro, e ainda tiver registros encontrados na consulta
	while ($status >= 0 & $dbocc("ctra_resordcarr"))

		;Verifica se a inst√¢ncia criada ainda est√° ativa
		if ($componentname("CFREO047_PROCOFERTA") = "")
			newinstance "CFREO047", "CFREO047_PROCOFERTA", "Transaction=TRUE"	
		endif

		;Atribiu dados a struct 
		v_stc_input                = $newstruct
		v_stc_input->id_motorista  = id_motorista.ctra_resordcarr
		v_stc_input->nr_versaoveic = nr_versaoveic.ctra_resordcarr
		v_stc_input->nr_ofertafrt  = nr_ofertafrt.ctra_resordcarr
		v_stc_input->tp_operador   = $t_tp_operador$
		v_stc_input->cd_operador   = $t_cd_operador$

		;Define opera√ß√£o para realizar commit de transa√ß√£o
		v_stc_input->in_commit     = <G_TRUE>

		;Realiza opera√ß√£o em outra operation em outro componente com inst√¢ncia separada 
		activate "CFREO047_PROCOFERTA".atualizarOferta(v_stc_input, v_stc_output, $t_ds_erro$)
		if ($status < 0) ;Valida√ß√£o de erros
			if ($status != <G_ERROEXEC>)
				call PL_ERRO_CMDMSG ($procerrorcontext)
			endif
		endif

		;Posiciona conuslta no pr√≥ximo registro
		setocc "ctra_resordcarr", $curocc("ctra_resordcarr") + 1
	endwhile

	;Deleta inst√¢ncia no final do processamento
	deleteinstance "CFREO047_PROCOFERTA"

	return(0) ;Retorna com sucesso

	Erro: ;Trecho referente ao processo de tratamento de erros

	deleteinstance "CFREO047_PROCOFERTA" ;Deleta inst√¢ncia
	$t_ds_erro$ = $concat($t_ds_erro$, " <PL_PROCESSAR_RESERVADO>") ;Atribui erro ao retorno

	rollback ;Realiza rollback doda dados trabalhados

	return (<G_ERROEXEC>) ;Retorna com erro
end
